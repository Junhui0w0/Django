{% extends 'base.html' %}
{% block content %}

<div class="container">
    <h5 class="my-3 border-bottom pb-2" readonly required>{{ form.subject.value|default_if_none:'' }}</h5><br>
    <form method="post" autocomplete="off">
        {% csrf_token %}
        <input type="hidden" name="category" value="{{ category }}">
        <!-- 제목 -->
        <!-- <div class="mb-3">
            <label for="subject" class="form-label">제목</label>
            <input type="text" class="form-control" name="subject" id="subject"
                   value="{{ form.subject.value|default_if_none:'' }}" required>
        </div> -->

        <!-- 보내는 분 정보 -->
        <div class="mb-3">
            <label for="send_name" class="form-label"><strong>보내는 분 성함</strong></label>
            <input type="text" class="form-control" name="send_name" id="send_name"
                   value="" required>
        </div>
        <div class="mb-3">
            <label for="send_phone" class="form-label"><strong>보내는 분 연락처 (- 포함하여 입력해주세요 | ex: 010-xxxx-yyyy)</strong></label>
            <input type="text" class="form-control" name="send_phone" id="send_phone"
                   value="{{ form.send_phone.value|default_if_none:'' }}" required>
        </div>


        <div class="mb-3">
            <label for="send_addr_zipcode" class="form-label"><strong>보내는 분 우편번호</strong></label>
            <div class="input-group">
                <input type="text" class="form-control" name="send_addr_zipcode" id="send_addr_zipcode" placeholder="우편번호" readonly required>
                <button type="button" class="btn btn-outline-secondary" onclick="execDaumPostcode('send_addr')"><strong>우편번호 찾기</strong></button>
            </div>
        </div>
        <div class="mb-3">
            <label for="send_addr_road" class="form-label"><strong>보내는 분 도로명 주소</strong></label>
            <input type="text" class="form-control" name="send_addr_road" id="send_addr_road" placeholder="도로명주소" readonly required>
        </div>
        <div class="mb-3">
            <label for="send_addr_detail" class="form-label"><strong>보내는 분 상세 주소</strong></label>
            <input type="text" class="form-control" name="send_addr_detail" id="send_addr_detail" placeholder="상세주소" required>
        </div>

        <!-- 구분선 -->
        <br>
        <hr class="my-4">
        <br>

        <!-- 받는 분 정보 -->
        <div class="mb-3">
            <label for="rec_name" class="form-label"><strong>받는 분 성함</strong></label>
            <input type="text" class="form-control" name="rec_name" id="rec_name"
                   value="{{ form.rec_name.value|default_if_none:'' }}" required>
        </div>
        <div class="mb-3">
            <label for="rec_phone" class="form-label"><strong>받는 분 연락처 (- 포함하여 입력해주세요 | ex: 010-xxxx-yyyy)</strong></label>
            <input type="text" class="form-control" name="rec_phone" id="rec_phone"
                   value="{{ form.rec_phone.value|default_if_none:'' }}" required>
        </div>

        
        <div class="mb-3">
            <label for="rec_addr_zipcode" class="form-label"><strong>받는 분 우편번호</strong></label>
            <div class="input-group">
                <input type="text" class="form-control" name="rec_addr_zipcode" id="rec_addr_zipcode" placeholder="우편번호" readonly required>
                <button type="button" class="btn btn-outline-secondary" onclick="execDaumPostcode('rec_addr')"><strong>우편번호 찾기</strong></button>
            </div>
        </div>
        <div class="mb-3">
            <label for="rec_addr_road" class="form-label"><strong>받는 분 도로명 주소</strong></label>
            <input type="text" class="form-control" name="rec_addr_road" id="rec_addr_road" placeholder="도로명주소" readonly required>
        </div>
        <div class="mb-3">
            <label for="rec_addr_detail" class="form-label"><strong>받는 분 상세 주소</strong></label>
            <input type="text" class="form-control" name="rec_addr_detail" id="rec_addr_detail" placeholder="상세주소" required>
        </div>

        <br>
        <hr class="my-4">
        <br>

        <!-- 상품 정보 -->
        <div class="mb-3">
            <label for="product_type" class="form-label"><strong>상품 종류</strong></label>
            <input type="text" class="form-control" name="product_type" id="product_type"
                   value="{{ form.product_type.value|default_if_none:'' }}" required>
        </div>

        <!-- 포장 형식 -->
        <div class="mb-3">
            <label for="id_package_type" class="form-label"><strong>포장 형식</strong></label>
            <select class="form-select mb-2" id="id_package_type" name="package_type" onchange="toggleCustomPackageInput(this)">
                <option value="">-- 선택하세요 --</option>
                <option value="naked" {% if form.package_type.value == "naked" %}selected{% endif %}>나체</option>
                <option value="box" {% if form.package_type.value == "box" %}selected{% endif %}>박스</option>
                <option value="vinyl" {% if form.package_type.value == "vinyl" %}selected{% endif %}>비닐</option>
                <option value="madae" {% if form.package_type.value == "madae" %}selected{% endif %}>마대</option>
                <option value="custom" {% if form.package_type.value not in "naked box vinyl madae" and form.package_type.value %}selected{% endif %}>직접 입력</option>
            </select>
            <input type="text" class="form-control mt-2"
                   id="custom_package_type"
                   name="custom_package_type"
                   placeholder="직접 입력"
                   style="display: none;"
                   value="{% if form.package_type.value not in 'naked box vinyl madae' and form.package_type.value %}{{ form.package_type.value }}{% endif %}">
        </div>

        <!-- 수량 -->
        <div class="mb-3">
            <label for="id_num" class="form-label"><strong>수량</strong></label>
            <select class="form-select mb-2" id="id_num" name="num" onchange="toggleCustomNumInput(this)">
                <option value="">-- 선택하세요 --</option>
                <option value="1" {% if form.num.value == "1" %}selected{% endif %}>1</option>
                <option value="2" {% if form.num.value == "2" %}selected{% endif %}>2</option>
                <option value="3" {% if form.num.value == "3" %}selected{% endif %}>3</option>
                <option value="4" {% if form.num.value == "4" %}selected{% endif %}>4</option>
                <option value="5" {% if form.num.value == "5" %}selected{% endif %}>5</option>
                <option value="custom" {% if form.num.value not in "1 2 3 4 5" and form.num.value %}selected{% endif %}>직접 입력</option>
            </select>
            <input type="text" min="1" class="form-control mt-2"
                   id="custom_num"
                   name="custom_num"
                   placeholder="직접 입력"
                   style="display: none;"
                   value="{% if form.num.value not in '1 2 3 4 5' and form.num.value %}{{ form.num.value }}{% endif %}">
        </div>

        <!-- 지불방식 -->
        <div class="mb-3">
            <label for="pay_method" class="form-label"><strong>지불방식</strong></label>
            <select class="form-select mb-2" id="pay_method" name="pay_method" required>
                <option value="">-- 선택하세요 --</option>
                <option value="at_now" {% if form.pay_method.value == "at_now" %}selected{% endif %}>현불(선불)</option>
                <option value="at_delivered" {% if form.pay_method.value == "at_delivered" %}selected{% endif %}>착불(후불)</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary">등록하기</button>
        <br><br><br><br><br>
    </form>
</div>

{% endblock %}
{% block script %}
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script type="text/javascript">

// 포장 형식 직접 입력
function toggleCustomPackageInput(select) {
    const customInput = document.getElementById('custom_package_type');
    if (select.value === 'custom') {
        customInput.style.display = 'block';
        customInput.removeAttribute('readonly');
    } else {
        customInput.style.display = 'none';
        customInput.setAttribute('readonly', true);
        customInput.value = '';
    }
}
// 수량 직접 입력
function toggleCustomNumInput(select) {
    const customInput = document.getElementById('custom_num');
    if (select.value === 'custom') {
        customInput.style.display = 'block';
        customInput.removeAttribute('readonly');
    } else {
        customInput.style.display = 'none';
        customInput.setAttribute('readonly', true);
        customInput.value = '';
    }
}

// 페이지 로드 시 직접입력 선택 상태 반영
window.addEventListener('DOMContentLoaded', function() {
    toggleCustomPackageInput(document.getElementById('id_package_type'));
    toggleCustomNumInput(document.getElementById('id_num'));
});

// 주소 자동완성(카카오/다음 API 연동용 예시 함수)
function execDaumPostcode(prefix) {
        new daum.Postcode({
            oncomplete: function(data) {
                // 우편번호와 주소 정보를 해당 필드에 넣음
                document.getElementById(prefix + '_zipcode').value = data.zonecode;
                document.getElementById(prefix + '_road').value = data.roadAddress;
                
                // 상세주소 필드로 포커스를 이동
                document.getElementById(prefix + '_detail').focus();
            }
        }).open();
    }
</script>
{% endblock %}